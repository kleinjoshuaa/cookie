<head>
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MFC6W65');</script>

    <!-- This is Amplitude --> 
    <script type="text/javascript">
(function(e,t){var n=e.amplitude||{_q:[],_iq:{}};var r=t.createElement("script")
;r.type="text/javascript"
;r.integrity="sha384-6T8z7Vvm13muXGhlR32onvIziA0TswSKafDQHgmkf6zD2ALZZeFokLI4rPVlAFyK"
;r.crossOrigin="anonymous";r.async=true
;r.src="https://cdn.amplitude.com/libs/amplitude-8.18.4-min.gz.js"
;r.onload=function(){if(!e.amplitude.runQueuedFunctions){console.log(
"[Amplitude] Error: could not load SDK")}};var s=t.getElementsByTagName("script"
)[0];s.parentNode.insertBefore(r,s);function i(e,t){e.prototype[t]=function(){
this._q.push([t].concat(Array.prototype.slice.call(arguments,0)));return this}}
var o=function(){this._q=[];return this};var a=["add","append","clearAll",
"prepend","set","setOnce","unset","preInsert","postInsert","remove"];for(
var c=0;c<a.length;c++){i(o,a[c])}n.Identify=o;var l=function(){this._q=[]
;return this};var u=["setProductId","setQuantity","setPrice","setRevenueType",
"setEventProperties"];for(var p=0;p<u.length;p++){i(l,u[p])}n.Revenue=l;var d=[
"init","logEvent","logRevenue","setUserId","setUserProperties","setOptOut",
"setVersionName","setDomain","setDeviceId","enableTracking",
"setGlobalUserProperties","identify","clearUserProperties","setGroup",
"logRevenueV2","regenerateDeviceId","groupIdentify","onInit","onNewSessionStart"
,"logEventWithTimestamp","logEventWithGroups","setSessionId","resetSessionId",
"getDeviceId","getUserId","setMinTimeBetweenSessionsMillis",
"setEventUploadThreshold","setUseDynamicConfig","setServerZone","setServerUrl",
"sendEvents","setLibrary","setTransport"];function v(t){function e(e){
t[e]=function(){t._q.push([e].concat(Array.prototype.slice.call(arguments,0)))}}
for(var n=0;n<d.length;n++){e(d[n])}}v(n);n.getInstance=function(e){e=(
!e||e.length===0?"$default_instance":e).toLowerCase();if(
!Object.prototype.hasOwnProperty.call(n._iq,e)){n._iq[e]={_q:[]};v(n._iq[e])}
return n._iq[e]};e.amplitude=n})(window,document);

amplitude.getInstance().init("70caac08859d71fe3c85e4a537c06c65")
var userId = "12345";
amplitude.getInstance().setUserId(userId);
var event = "Button Clicked";
var eventProperties = {
    "hover time": "100ms"
};
amplitude.getInstance().logEvent(event, eventProperties);
  </script>
<!-- <script>
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="S4ZHSsZ0pC0HgeFb6eDWE1wvYthU7ClX";;analytics.SNIPPET_VERSION="4.15.3";
  analytics.load("S4ZHSsZ0pC0HgeFb6eDWE1wvYthU7ClX");
  analytics.page();
  }}();
</script> -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YF1F8NQT2N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YF1F8NQT2N', { 'debug_mode':true });

  //gtag('set', {splitInfo: []});
</script>
<!-- <script src="https://cdn.jsdelivr.net/npm/@analytics-debugger/ga4mp@latest/dist/ga4mp.umd.min.js"></script> -->
<script>
//const ga4track = ga4mp(["G-YF1F8NQT2N"], {  
//  user_id: 'userabc',
//  non_personalized_ads: false,
//  debug: true
//});
</script>

<!-- google optimize -->
<script src="https://www.googleoptimize.com/optimize.js?id=OPT-NQQWXP2"></script>

  <!-- End Google Tag Manager -->
  <!-- This is MixPanel -->
   <script type="text/javascript">
    (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
    for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
    MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
    
    // Enabling the debug mode flag is useful during implementation,
    // but it's recommended you remove it for production
    mixpanel.init('93a19246f2098c5aafb97572423b8d37', {debug: true}); 
    mixpanel.track('Sign Up', {
  'source': "Pat's affiliate site",
  'Opted out of email': true,
});
    </script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {%- seo -%}
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
  <link rel="stylesheet" href="{{ "/assets/css/style.css" | relative_url }}">
    <link
      rel="stylesheet"
      href="/assets/vendor/@fortawesome/fontawesome-free/css/all.min.css"
    />
    <script src="//cdn.split.io/sdk/split-10.20.0.min.js"></script>
    <script>

  // 
  // Impression Data has the following fields:
  //  {
  // "impression":{
  //    "feature":"Demo_TL",
  //    "keyName":"key",
  //    "treatment":"off",
  //    "time":1681158925738,
  //    "label":"default rule",
  //    "changeNumber":1665436973467
  // },
  // "ip":false,
  // "hostname":false,
  // "sdkLanguageVersion":"javascript-10.20.0"
  //}
  //console.log(JSON.stringify(impressionData));
function logImpression(impressionData) {

//  gtag('event', 'split_impression', {
//    'split_name': impressionData.impression.feature,
//    'split_treatment': impressionData.impression.treatment,
//    'split_label': impressionData.impression.label,
//    'split_changeno': impressionData.impression.changeNumber
    // can add additional properties here as well

/*
const measurement_id = 'G-YF1F8NQT2N';
const api_secret = `ifH-KZFiTfOFQvZKBG2wEw`;
 fetch(`https://www.google-analytics.com/mp/collect?measurement_id=${measurement_id}&api_secret=${api_secret}`, {
  method: "POST",
  body: JSON.stringify({
      "client_id": impressionData.impression.keyName,
      "events": [{
          "name": "split_impression",
          "params": {
'split_name': impressionData.impression.feature,
'split_treatment': impressionData.impression.treatment,
'split_label': impressionData.impression.label,
'split_changeno': impressionData.impression.changeNumber,
          }
      }]
  })
}).then(() => {
  console.log('sent to ga')
}).catch((error) => {
  console.log(error)
})*/
gtag('get', 'G-YF1F8NQT2N', 'splitInfo', (splitInfo) => {
  // Do something with currency value you set earlier
  console.log(JSON.stringify(splitInfo))
  var arr = JSON.parse(splitInfo);
  gtag('set', {splitInfo: JSON.stringify([...splitInfo, impressionData.impression])});
})


}

    var factory = splitio({
      core: {
        authorizationKey: 'vvtehm93rm3i5nvivp4s5571v0o2rrc98u6d',
        // key represents your internal user id, or the account id that
        // the user belongs to.
        // This could also be a cookie you generate for anonymous users
        key: 'key'
      },
      impressionListener: {
        logImpression: logImpression
      }
    });
    // And get the client instance you'll use
    var client = factory.client();
    dataLayer.push({ split_client: client });
    client.on(client.Event.SDK_READY, function() {
  var treatment = client.getTreatment("Demo_TL");
  if (treatment == "on") {
      // insert code here to show on treatment
      console.log('on!!!')
  } else if (treatment == "off") {
      // insert code here to show off treatment
  } else {
      // insert your control treatment code here
  }
});
//analytics.track('Signed Up', {
//  plan: 'Enterprise'
//});
//analytics.identify({
//  nickname: 'Amazing Grace',
//  favoriteCompiler: 'A-0',
//  industry: 'Computer Science'
//});
//analytics.page({
//  userId: "some_user_id",
//  category: "Merchant",
// name: "Signup",
//})
// analytics.screen({
//   userId: "some_user_id",
//   category: "Merchant",
//   name: "Signup",
// })

//ga4track.setEventsParameter('trackedInSplit', ()=>{
 // return client.track('user', 'EVENT_TYPE', 0, { 'prop':'val' });
//})
setInterval(function () {
  gtag('event', 'click_outgoing', {
    clicked_url: 'https://www.thyngster.com',
    time: 12323,
    splitInfo: gtag
  })


}, 1000)



//ga4track.trackEvent('click_outgoing', {
//  clicked_url: 'https://www.thyngster.com',
//  time: 12323
//})




</script>
    
  {%- feed_meta -%}
  {%- include custom-head.html -%}

</head>
